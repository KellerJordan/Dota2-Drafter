<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<body>
	Heroes:<br>
	Enter without capital letters or symbols, replace spaces with hyphens.
	<form>
		<input type="text" id="hero1"><br>
		<input type="text" id="hero2"><br>
		<input type="text" id="hero3"><br>
		<input type="text" id="hero4"><br>
		<input type="text" id="hero5">
	</form>
	<button type="button" onclick="getBestHeroes()">Submit Data</button>
	<button type="button" onclick="updateHeroData()">Update Stored Data</button>
	<br><br><br>
	<table></table>
</body>
<script>

var heroList;
function getBestHeroes(){
	var pickedHeroes=[];
	for(var i=1;i<6;i++){
		var heroName=document.getElementById("hero"+i).value;
		if(heroName!=""){
			pickedHeroes.push(heroName);
		}
	}

	$.post("winrateWriter.php",{
		data:JSON.stringify(pickedHeroes),
		type:"in"
	},
	function(data,status){
		heroList=JSON.parse(data);
		$("table").empty();
		for(name in heroList){
			var advantage=-1*heroList[name];
			var line=$("<tr></tr>");
			line.append($("<td></td>").html(name));
			line.append($("<td></td>").html(advantage));
			$("table").append(line);
		}
	});
}

function updateHeroData(){
	if(confirm("Are you sure? This will take up to 10 minutes.")){
		getHeroData("pudge",true);
	}
}
var heroNames=[];
var index=0;
function getHeroData(hero,seed){
	$.ajax({
	    url: "http://www.dotabuff.com/heroes/"+hero+"/matchups?date=patch_6.87",
	    dataType: 'text',
	    success: function(data){
	        var elements=$("<div>").html(data)[0].getElementsByTagName("tbody")[0].getElementsByTagName("tr");
	        var heroData=[];
	        for(i=0;i<elements.length;i++){
	        	var tds=elements[i].getElementsByTagName("td");
	        	var heroName=$(tds[0]).attr("data-value").toLowerCase().replace(/\s/g, "-").replace(/'/g, '');
	        	var heroAdvantage=parseFloat($(tds[2]).attr("data-value"));
	        	heroData.push({name:heroName,advantage:heroAdvantage});
	        	if(seed){
	        		heroNames.push(heroName);
	        	}
	        }
	        $.post("winrateWriter.php",{
	        	data:JSON.stringify(heroData),type:"out",name:hero
	        },function(data,success){
	        	if(index<111){
	        		console.log("***********************************************************************");
	        		console.log(index+1+"/111");
	        		console.log("***********************************************************************");
	        		getHeroData(heroNames[index],false);
	        		index++;
	        	}else{
	        		console.log("***********************************************************************");
	        		console.log("COMPLETE");
	        		console.log("***********************************************************************");
	        	}
	        }
	        );
	    }
	});
}

</script>
</html>